---
kind: pipeline
name: default

dev: &build
  image: docker:latest
  environment:
    DOCKER_USER:
      from_secret: username
    DOCKER_PASS:
      from_secret: dockerpw
  command:
    - echo $PATH
    - docker -v
    - docker images
    - &login echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin
    - make dev-release
  when:
    &dev-push
    branch:
      exclude:
        - master


steps:
- name: mydog-dev
  <<: *build

- name: mydog
  <<: *build
  command:
    - *login
    - make release

  when:
    &master-push
    branch:
      - master
    event:
      - push
